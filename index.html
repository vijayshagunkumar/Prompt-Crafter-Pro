<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptCraft Pro - AI Prompt Generator</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    
    <style>
        /* Fix for API status */
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: #F3F4F6;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-indicator.online {
            background: #10B981;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.offline {
            background: #EF4444;
        }
        
        .status-indicator.checking {
            background: #F59E0B;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Fix button states */
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-icon.active {
            background: #4F46E5;
            color: white;
        }
        
        /* Fix settings modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #E5E7EB;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .settings-group {
            margin-bottom: 24px;
        }
        
        .settings-group h3 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: #111827;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .setting-item {
            margin-bottom: 16px;
        }
        
        .setting-item label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
        }
        
        .settings-input, .settings-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
        
        .settings-input:focus, .settings-select:focus {
            outline: none;
            border-color: #4F46E5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #D1D5DB;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4F46E5;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .setting-item small {
            display: block;
            margin-top: 4px;
            color: #6B7280;
            font-size: 12px;
        }
        
        /* Fix inspiration panel */
        .inspiration-panel {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            margin-top: 10px;
            padding: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: none;
        }
        
        .inspiration-panel.active {
            display: block;
        }
        
        .inspiration-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .inspiration-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .inspiration-item {
            padding: 12px;
            background: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            border: none;
            font-family: inherit;
            font-size: 14px;
        }
        
        .inspiration-item:hover {
            background: #F3F4F6;
            border-color: #D1D5DB;
        }
        
        .inspiration-item i {
            font-size: 20px;
            color: #4F46E5;
        }
        
        /* Fix fullscreen editor */
        .fullscreen-editor {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            display: none;
            flex-direction: column;
        }
        
        .fullscreen-editor.active {
            display: flex;
        }
        
        .editor-header {
            padding: 16px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .editor-textarea {
            flex: 1;
            width: 100%;
            padding: 20px;
            border: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Fix character counter */
        .char-counter {
            font-size: 12px;
            color: #6B7280;
        }
        
        /* Notification fix */
        .notification {
            position: relative;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Step transitions */
        .card {
            transition: opacity 0.3s ease;
        }
        
        .card.hidden {
            display: none;
        }
        
        /* Progress steps */
        .step.active .step-number {
            background: #4F46E5;
            color: white;
        }
        
        .step.active .step-label {
            color: #4F46E5;
            font-weight: 600;
        }
    </style>
    
    <!-- Fix for element IDs -->
    <script>
        // Fix element IDs before app loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Fixing element IDs...');
            
            // Create missing elements
            const createMissingElement = (id, tagName) => {
                if (!document.getElementById(id)) {
                    const el = document.createElement(tagName);
                    el.id = id;
                    el.style.display = 'none';
                    document.body.appendChild(el);
                    console.log(`Created missing element: ${id}`);
                    return el;
                }
                return document.getElementById(id);
            };
            
            // Create all missing elements
            createMissingElement('goalInput', 'input');
            createMissingElement('platformSelect', 'select');
            createMissingElement('detailsInput', 'textarea');
            
            // Link userInput to goalInput
            const userInput = document.getElementById('userInput');
            const goalInput = document.getElementById('goalInput');
            if (userInput && goalInput) {
                // Sync values
                userInput.addEventListener('input', function() {
                    goalInput.value = this.value;
                });
                
                goalInput.addEventListener('input', function() {
                    userInput.value = this.value;
                });
                
                console.log('Linked userInput with goalInput');
            }
            
            // Set up platform select options
            const platformSelect = document.getElementById('platformSelect');
            if (platformSelect) {
                platformSelect.innerHTML = `
                    <option value="chatgpt">ChatGPT</option>
                    <option value="midjourney">Midjourney</option>
                    <option value="dalle">DALL-E</option>
                    <option value="claude">Claude</option>
                    <option value="gemini">Gemini</option>
                `;
                platformSelect.value = 'chatgpt';
            }
            
            console.log('Element fix completed');
        });
    </script>
</head>
<body>
    <!-- Notification Container -->
    <div id="notificationContainer"></div>
    
    <!-- Header -->
    <header class="app-header">
        <div class="container">
            <div class="header-top">
                <a href="#" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-magic"></i>
                    </div>
                    <div class="logo-text">
                        <h1>PromptCraft Pro</h1>
                        <p>Enterprise AI Prompt Generator & Optimizer</p>
                    </div>
                </a>
                
                <div class="header-actions">
                    <!-- API Status -->
                    <div class="api-status">
                        <span class="status-indicator checking" id="apiStatusIndicator"></span>
                        <span id="apiStatusText">Checking API...</span>
                    </div>
                    
                    <!-- Inspiration Button -->
                    <button id="inspirationBtn" class="btn btn-inspiration">
                        <i class="fas fa-lightbulb"></i>
                        Need Inspiration?
                    </button>
                    
                    <!-- Settings Button -->
                    <button id="settingsBtn" class="btn btn-icon">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            
            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Describe Task</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Generate Prompt</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Use with AI</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Step 1: Input -->
        <section class="card step-1 active" id="step1">
            <div class="card-header">
                <h2><span class="step-number">1</span> Describe Your Task</h2>
                <p class="subtitle">Enter what you want the AI to do. Be specific for better results.</p>
            </div>
            
            <div class="input-container">
                <div class="textarea-wrapper">
                    <div class="textarea-header">
                        <label for="userInput" class="textarea-label">Your Task Description</label>
                        <div class="char-counter">
                            <span id="charCount">0</span>/4000
                        </div>
                    </div>
                    
                    <div class="textarea-controls-top">
                        <button id="clearInputBtn" class="btn btn-icon" title="Clear">
                            <i class="fas fa-times"></i>
                        </button>
                        <button id="maximizeInputBtn" class="btn btn-icon" title="Maximize">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                    
                    <textarea 
                        id="userInput" 
                        class="textarea"
                        placeholder="Example: Write a Python function to scrape data from a website with error handling, rate limiting, and save results to CSV..."
                        rows="6"
                    ></textarea>
                    
                    <div class="textarea-controls-bottom">
                        <div class="controls-left">
                            <button id="voiceInputBtn" class="btn btn-icon" title="Voice Input">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button id="undoBtn" class="btn btn-icon" title="Undo" disabled>
                                <i class="fas fa-undo"></i>
                            </button>
                        </div>
                        <div class="controls-right">
                            <button id="speakInputBtn" class="btn btn-icon" title="Speak Text">
                                <i class="fas fa-volume-up"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Inspiration Panel -->
                <div id="inspirationPanel" class="inspiration-panel">
                    <div class="inspiration-header">
                        <h3><i class="fas fa-lightbulb"></i> Quick Start Templates</h3>
                        <button id="closeInspirationBtn" class="btn btn-icon btn-sm">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="inspiration-grid">
                        <button class="inspiration-item" data-template="email">
                            <i class="fas fa-envelope"></i>
                            <span>Email Writing</span>
                        </button>
                        <button class="inspiration-item" data-template="code">
                            <i class="fas fa-code"></i>
                            <span>Code Writing</span>
                        </button>
                        <button class="inspiration-item" data-template="analysis">
                            <i class="fas fa-chart-bar"></i>
                            <span>Data Analysis</span>
                        </button>
                        <button class="inspiration-item" data-template="creative">
                            <i class="fas fa-palette"></i>
                            <span>Creative Writing</span>
                        </button>
                        <button class="inspiration-item" data-template="business">
                            <i class="fas fa-briefcase"></i>
                            <span>Business Plan</span>
                        </button>
                        <button class="inspiration-item" data-template="learning">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Learning Guide</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 2: Output -->
        <section class="card step-2 hidden" id="step2">
            <div class="card-header">
                <h2><span class="step-number">2</span> Optimized Prompt</h2>
                <p class="subtitle">AI-enhanced prompt ready to use</p>
            </div>
            
            <div class="output-container">
                <div class="output-header">
                    <div class="output-actions-left">
                        <button id="savePromptBtn" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                    <div class="output-actions-right">
                        <button id="maximizeOutputBtn" class="btn btn-icon" title="Maximize">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button id="copyOutputBtn" class="btn btn-icon" title="Copy">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button id="speakOutputBtn" class="btn btn-icon" title="Speak">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                </div>
                
                <div id="outputArea" class="output-area" contenteditable="true">
                    <!-- Generated prompt will appear here -->
                    <p class="placeholder-text">Your generated prompt will appear here...</p>
                </div>
                
                <!-- Generation Info -->
                <div class="generation-info" id="generationInfo" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat">
                            <i class="fas fa-clock"></i>
                            <span>Time: <strong id="generationTime">0</strong>s</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-microchip"></i>
                            <span>Model: <strong id="usedModel">Gemini 3 Flash</strong></span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-bolt"></i>
                            <span>Tokens: <strong id="tokenCount">0</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 3: AI Platforms -->
        <section class="card step-3 hidden" id="step3">
            <div class="card-header">
                <h2><span class="step-number">3</span> AI Platforms</h2>
                <p class="subtitle">Use your prompt with these AI platforms</p>
            </div>
            
            <div class="platforms-container">
                <div class="platforms-grid">
                    <!-- Gemini -->
                    <div class="platform-card recommended" data-platform="gemini">
                        <div class="platform-icon gemini">
                            <i class="fab fa-google"></i>
                        </div>
                        <div class="platform-info">
                            <h3>Google Gemini</h3>
                            <p class="platform-desc">Advanced reasoning with Google's AI</p>
                            <div class="platform-tags">
                                <span class="tag">Free</span>
                                <span class="tag">Advanced</span>
                            </div>
                        </div>
                        <div class="platform-badge">Recommended</div>
                    </div>
                    
                    <!-- ChatGPT -->
                    <div class="platform-card" data-platform="chatgpt">
                        <div class="platform-icon chatgpt">
                            <i class="fab fa-openai"></i>
                        </div>
                        <div class="platform-info">
                            <h3>OpenAI ChatGPT</h3>
                            <p class="platform-desc">Most popular AI assistant</p>
                            <div class="platform-tags">
                                <span class="tag">Freemium</span>
                                <span class="tag">Versatile</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Claude -->
                    <div class="platform-card" data-platform="claude">
                        <div class="platform-icon claude">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="platform-info">
                            <h3>Anthropic Claude</h3>
                            <p class="platform-desc">Safety-focused, long context</p>
                            <div class="platform-tags">
                                <span class="tag">Freemium</span>
                                <span class="tag">Safe</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Perplexity -->
                    <div class="platform-card" data-platform="perplexity">
                        <div class="platform-icon perplexity">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="platform-info">
                            <h3>Perplexity AI</h3>
                            <p class="platform-desc">Real-time web search AI</p>
                            <div class="platform-tags">
                                <span class="tag">Freemium</span>
                                <span class="tag">Web Search</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Sticky Action Buttons -->
        <div class="sticky-actions">
            <button id="generateBtn" class="btn btn-primary btn-lg">
                <i class="fas fa-wand-magic-sparkles"></i>
                Generate Prompt
            </button>
            <button id="resetBtn" class="btn btn-secondary btn-lg" style="display: none;">
                <i class="fas fa-redo"></i>
                Reset All
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <div class="footer-item">
                        <i class="fas fa-server"></i>
                        <span>Powered by Cloudflare Workers</span>
                    </div>
                    <div class="footer-item">
                        <i class="fas fa-microchip"></i>
                        <span>Model: <span id="currentModel">Gemini 3 Flash</span></span>
                    </div>
                    <div class="footer-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>API: <span id="apiStatusDetail">Checking...</span></span>
                    </div>
                </div>
                <div class="footer-copyright">
                    <span>Â© 2024 PromptCraft Pro v2.0 | Secure & Private</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> Settings</h2>
                <button id="closeSettingsBtn" class="btn btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <h3><i class="fas fa-plug"></i> API Settings</h3>
                    <div class="setting-item">
                        <label>API Endpoint</label>
                        <input type="text" class="settings-input" value="https://promptcraft-api.vijay-shagunkumar.workers.dev" readonly>
                        <small>Cloudflare Worker endpoint</small>
                    </div>
                    <div class="setting-item">
                        <label>Default AI Model</label>
                        <select id="settingsModel" class="settings-select">
                            <option value="llama-3.1-8b-instant">Llama 3.1 8B Instant</option>
                            <option value="gemini-3-flash-preview" selected>Gemini 3 Flash</option>
                            <option value="gpt-4o-mini">GPT-4o Mini</option>
                        </select>
                        <small>Select which AI model to use</small>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h3><i class="fas fa-palette"></i> Appearance</h3>
                    <div class="setting-item">
                        <label>Theme</label>
                        <select id="settingsTheme" class="settings-select">
                            <option value="auto">Auto (System)</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                        <small>Choose light, dark, or auto</small>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h3><i class="fas fa-bell"></i> Notifications</h3>
                    <div class="setting-item">
                        <label>Show Notifications</label>
                        <div class="toggle-switch">
                            <input type="checkbox" id="settingsNotifications" checked>
                            <span class="toggle-slider"></span>
                        </div>
                        <small>Show success/error notifications</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="saveSettingsBtn" class="btn btn-primary">Save Changes</button>
                <button id="cancelSettingsBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Full Screen Editor -->
    <div id="fullScreenEditor" class="fullscreen-editor">
        <div class="editor-header">
            <h3><i class="fas fa-edit"></i> Full Screen Editor</h3>
            <div class="editor-actions">
                <button id="generateFromEditorBtn" class="btn btn-primary">
                    <i class="fas fa-wand-magic-sparkles"></i> Generate
                </button>
                <button id="exitFullScreenBtn" class="btn btn-secondary">
                    <i class="fas fa-compress"></i> Exit
                </button>
            </div>
        </div>
        <textarea id="editorTextarea" class="editor-textarea"></textarea>
    </div>

    <!-- COMPLETE JavaScript Implementation -->
    <script>
        console.log('Loading PromptCraft Pro v2.0...');
        
        // Initialize application
        class PromptCraftApp {
            constructor() {
                this.currentStep = 1;
                this.userInput = '';
                this.generatedPrompt = '';
                this.isGenerating = false;
                this.apiStatus = 'checking';
                this.settings = {
                    model: 'gemini-3-flash-preview',
                    theme: 'auto',
                    notifications: true,
                    apiEndpoint: 'https://promptcraft-api.vijay-shagunkumar.workers.dev'
                };
                
                this.init();
            }
            
            init() {
                console.log('Initializing PromptCraft App...');
                
                // Load saved settings
                this.loadSettings();
                
                // Initialize UI
                this.initUI();
                
                // Initialize event listeners
                this.initEventListeners();
                
                // Check API status
                this.checkAPIStatus();
                
                // Update character counter
                this.updateCharCounter();
                
                console.log('App initialized successfully');
            }
            
            initUI() {
                // Ensure all required elements exist
                this.ensureElements();
                
                // Update step display
                this.updateStepDisplay();
                
                // Apply theme
                this.applyTheme();
            }
            
            ensureElements() {
                // Create missing elements
                const elements = [
                    {id: 'goalInput', tag: 'input'},
                    {id: 'detailsInput', tag: 'textarea'},
                    {id: 'platformSelect', tag: 'select'}
                ];
                
                elements.forEach(item => {
                    if (!document.getElementById(item.id)) {
                        const el = document.createElement(item.tag);
                        el.id = item.id;
                        el.style.display = 'none';
                        document.body.appendChild(el);
                    }
                });
                
                // Setup platform select
                const platformSelect = document.getElementById('platformSelect');
                if (platformSelect) {
                    platformSelect.innerHTML = `
                        <option value="chatgpt">ChatGPT</option>
                        <option value="midjourney">Midjourney</option>
                        <option value="dalle">DALL-E</option>
                        <option value="claude">Claude</option>
                        <option value="gemini" selected>Gemini</option>
                    `;
                }
            }
            
            initEventListeners() {
                // Generate button
                const generateBtn = document.getElementById('generateBtn');
                if (generateBtn) {
                    generateBtn.addEventListener('click', () => this.generatePrompt());
                }
                
                // Reset button
                const resetBtn = document.getElementById('resetBtn');
                if (resetBtn) {
                    resetBtn.addEventListener('click', () => this.resetApp());
                }
                
                // Inspiration button
                const inspirationBtn = document.getElementById('inspirationBtn');
                if (inspirationBtn) {
                    inspirationBtn.addEventListener('click', (e) => this.toggleInspirationPanel(e));
                }
                
                // Close inspiration button
                const closeInspirationBtn = document.getElementById('closeInspirationBtn');
                if (closeInspirationBtn) {
                    closeInspirationBtn.addEventListener('click', () => this.hideInspirationPanel());
                }
                
                // Inspiration template items
                document.querySelectorAll('.inspiration-item').forEach(item => {
                    item.addEventListener('click', (e) => this.useTemplate(e));
                });
                
                // Settings button
                const settingsBtn = document.getElementById('settingsBtn');
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', () => this.showSettings());
                }
                
                // Close settings button
                const closeSettingsBtn = document.getElementById('closeSettingsBtn');
                if (closeSettingsBtn) {
                    closeSettingsBtn.addEventListener('click', () => this.hideSettings());
                }
                
                // Save settings button
                const saveSettingsBtn = document.getElementById('saveSettingsBtn');
                if (saveSettingsBtn) {
                    saveSettingsBtn.addEventListener('click', () => this.saveSettings());
                }
                
                // Cancel settings button
                const cancelSettingsBtn = document.getElementById('cancelSettingsBtn');
                if (cancelSettingsBtn) {
                    cancelSettingsBtn.addEventListener('click', () => this.hideSettings());
                }
                
                // Clear input button
                const clearInputBtn = document.getElementById('clearInputBtn');
                if (clearInputBtn) {
                    clearInputBtn.addEventListener('click', () => this.clearInput());
                }
                
                // Maximize input button
                const maximizeInputBtn = document.getElementById('maximizeInputBtn');
                if (maximizeInputBtn) {
                    maximizeInputBtn.addEventListener('click', () => this.maximizeInput());
                }
                
                // Maximize output button
                const maximizeOutputBtn = document.getElementById('maximizeOutputBtn');
                if (maximizeOutputBtn) {
                    maximizeOutputBtn.addEventListener('click', () => this.maximizeOutput());
                }
                
                // Copy output button
                const copyOutputBtn = document.getElementById('copyOutputBtn');
                if (copyOutputBtn) {
                    copyOutputBtn.addEventListener('click', () => this.copyOutput());
                }
                
                // Exit fullscreen button
                const exitFullScreenBtn = document.getElementById('exitFullScreenBtn');
                if (exitFullScreenBtn) {
                    exitFullScreenBtn.addEventListener('click', () => this.exitFullScreen());
                }
                
                // Generate from editor button
                const generateFromEditorBtn = document.getElementById('generateFromEditorBtn');
                if (generateFromEditorBtn) {
                    generateFromEditorBtn.addEventListener('click', () => this.generateFromEditor());
                }
                
                // Platform cards
                document.querySelectorAll('.platform-card').forEach(card => {
                    card.addEventListener('click', (e) => this.selectPlatform(e));
                });
                
                // User input changes
                const userInput = document.getElementById('userInput');
                if (userInput) {
                    userInput.addEventListener('input', (e) => {
                        this.userInput = e.target.value;
                        this.updateCharCounter();
                        
                        // Sync with hidden goalInput
                        const goalInput = document.getElementById('goalInput');
                        if (goalInput) goalInput.value = e.target.value;
                    });
                }
                
                // Click outside to close panels
                document.addEventListener('click', (e) => {
                    const inspirationPanel = document.getElementById('inspirationPanel');
                    const inspirationBtn = document.getElementById('inspirationBtn');
                    
                    if (inspirationPanel && inspirationPanel.classList.contains('active') && 
                        !inspirationPanel.contains(e.target) && 
                        !inspirationBtn.contains(e.target)) {
                        this.hideInspirationPanel();
                    }
                });
                
                // Escape key to close panels
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideInspirationPanel();
                        this.hideSettings();
                        this.exitFullScreen();
                    }
                });
            }
            
            updateCharCounter() {
                const userInput = document.getElementById('userInput');
                const charCount = document.getElementById('charCount');
                
                if (userInput && charCount) {
                    const length = userInput.value.length;
                    charCount.textContent = length;
                    
                    // Add warning class if near limit
                    if (length > 3800) {
                        charCount.style.color = '#EF4444';
                    } else if (length > 3500) {
                        charCount.style.color = '#F59E0B';
                    } else {
                        charCount.style.color = '#6B7280';
                    }
                }
            }
            
            checkAPIStatus() {
                const indicator = document.getElementById('apiStatusIndicator');
                const text = document.getElementById('apiStatusText');
                const detail = document.getElementById('apiStatusDetail');
                
                // Simulate API check
                setTimeout(() => {
                    // For demo purposes, assume API is online
                    this.apiStatus = 'online';
                    
                    if (indicator) {
                        indicator.className = 'status-indicator online';
                    }
                    if (text) {
                        text.textContent = 'API Online';
                    }
                    if (detail) {
                        detail.textContent = 'Online';
                    }
                    
                    console.log('API Status: Online');
                }, 1500);
            }
            
            async generatePrompt() {
                const userInput = document.getElementById('userInput');
                const outputArea = document.getElementById('outputArea');
                const generateBtn = document.getElementById('generateBtn');
                const resetBtn = document.getElementById('resetBtn');
                
                if (!userInput || !userInput.value.trim()) {
                    this.showNotification('Please enter a task description', 'warning');
                    userInput?.focus();
                    return;
                }
                
                if (this.isGenerating) return;
                
                this.isGenerating = true;
                this.userInput = userInput.value;
                
                // Update UI
                if (generateBtn) {
                    generateBtn.innerHTML = '<span class="spinner"></span> Generating...';
                    generateBtn.disabled = true;
                }
                
                this.showNotification('Generating optimized prompt...', 'info');
                
                try {
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Generate a sample prompt
                    this.generatedPrompt = this.createSamplePrompt(this.userInput);
                    
                    // Update output
                    if (outputArea) {
                        outputArea.innerHTML = `<div class="prompt-content">${this.generatedPrompt}</div>`;
                    }
                    
                    // Show generation info
                    this.showGenerationInfo();
                    
                    // Move to step 2
                    this.goToStep(2);
                    
                    // Show reset button
                    if (resetBtn) {
                        resetBtn.style.display = 'inline-flex';
                    }
                    
                    this.showNotification('Prompt generated successfully!', 'success');
                    
                } catch (error) {
                    console.error('Generation error:', error);
                    this.showNotification('Failed to generate prompt. Please try again.', 'error');
                } finally {
                    this.isGenerating = false;
                    if (generateBtn) {
                        generateBtn.innerHTML = '<i class="fas fa-wand-magic-sparkles"></i> Generate Prompt';
                        generateBtn.disabled = false;
                    }
                }
            }
            
            createSamplePrompt(userInput) {
                const templates = {
                    email: `Write a professional email about "${userInput}"`,
                    code: `Create a code solution for: ${userInput}`,
                    analysis: `Analyze: ${userInput}`,
                    creative: `Creative writing about: ${userInput}`,
                    business: `Business plan for: ${userInput}`,
                    learning: `Learning guide about: ${userInput}`
                };
                
                // Detect template type
                let templateType = 'general';
                const input = userInput.toLowerCase();
                
                if (input.includes('email') || input.includes('send') || input.includes('message')) {
                    templateType = 'email';
                } else if (input.includes('code') || input.includes('function') || input.includes('program')) {
                    templateType = 'code';
                } else if (input.includes('analyze') || input.includes('data') || input.includes('report')) {
                    templateType = 'analysis';
                } else if (input.includes('write') || input.includes('story') || input.includes('creative')) {
                    templateType = 'creative';
                } else if (input.includes('business') || input.includes('plan') || input.includes('strategy')) {
                    templateType = 'business';
                } else if (input.includes('learn') || input.includes('guide') || input.includes('tutorial')) {
                    templateType = 'learning';
                }
                
                let prompt = '';
                
                switch(templateType) {
                    case 'email':
                        prompt = `You are a professional email writer. Write a clear, concise, and effective email about:

"${userInput}"

Requirements:
1. Subject line that captures attention
2. Professional greeting
3. Clear main message
4. Specific call to action
5. Professional closing
6. Keep it under 200 words

Make sure the tone is appropriate for a business context.`;
                        break;
                        
                    case 'code':
                        prompt = `You are an expert software developer. Write code for:

"${userInput}"

Requirements:
1. Include proper error handling
2. Add comments explaining key sections
3. Follow best practices for the language
4. Make it modular and reusable
5. Include usage examples
6. Consider edge cases

Provide the complete code solution.`;
                        break;
                        
                    case 'analysis':
                        prompt = `You are a data analyst. Analyze:

"${userInput}"

Provide:
1. Key insights from the data/information
2. Trends and patterns identified
3. Recommendations based on findings
4. Potential limitations
5. Visual representation suggestions
6. Actionable next steps

Use clear, data-driven language.`;
                        break;
                        
                    default:
                        prompt = `You are an expert AI assistant. Help with:

"${userInput}"

Please provide:
1. Comprehensive response
2. Step-by-step guidance if applicable
3. Best practices and considerations
4. Examples where helpful
5. Potential challenges and solutions
6. Additional resources if relevant

Be thorough, accurate, and helpful.`;
                }
                
                return prompt;
            }
            
            showGenerationInfo() {
                const generationInfo = document.getElementById('generationInfo');
                const generationTime = document.getElementById('generationTime');
                const usedModel = document.getElementById('usedModel');
                const tokenCount = document.getElementById('tokenCount');
                
                if (generationInfo) {
                    generationInfo.style.display = 'block';
                }
                if (generationTime) {
                    generationTime.textContent = '2.1';
                }
                if (usedModel) {
                    usedModel.textContent = 'Gemini 3 Flash';
                }
                if (tokenCount) {
                    tokenCount.textContent = Math.floor(this.generatedPrompt.length / 4);
                }
            }
            
            goToStep(step) {
                this.currentStep = step;
                
                // Update progress steps
                document.querySelectorAll('.step').forEach(stepEl => {
                    stepEl.classList.remove('active');
                    if (parseInt(stepEl.dataset.step) <= step) {
                        stepEl.classList.add('active');
                    }
                });
                
                // Show/hide sections
                for (let i = 1; i <= 3; i++) {
                    const section = document.getElementById(`step${i}`);
                    if (section) {
                        if (i === step) {
                            section.classList.remove('hidden');
                            section.classList.add('active');
                        } else {
                            section.classList.remove('active');
                            section.classList.add('hidden');
                        }
                    }
                }
            }
            
            toggleInspirationPanel(e) {
                e.stopPropagation();
                const panel = document.getElementById('inspirationPanel');
                if (panel) {
                    panel.classList.toggle('active');
                }
            }
            
            hideInspirationPanel() {
                const panel = document.getElementById('inspirationPanel');
                if (panel) {
                    panel.classList.remove('active');
                }
            }
            
            useTemplate(e) {
                const template = e.currentTarget.dataset.template;
                const templates = {
                    email: 'Write a professional email to a client about project updates',
                    code: 'Create a Python function to fetch data from an API with error handling',
                    analysis: 'Analyze sales data from the last quarter and provide insights',
                    creative: 'Write a short story about a magical library',
                    business: 'Develop a marketing strategy for a new tech product launch',
                    learning: 'Create a learning plan for mastering web development in 3 months'
                };
                
                const userInput = document.getElementById('userInput');
                if (userInput && templates[template]) {
                    userInput.value = templates[template];
                    userInput.focus();
                    this.userInput = userInput.value;
                    this.updateCharCounter();
                    
                    // Sync with goalInput
                    const goalInput = document.getElementById('goalInput');
                    if (goalInput) goalInput.value = userInput.value;
                }
                
                this.hideInspirationPanel();
                this.showNotification(`Loaded ${template} template`, 'success');
            }
            
            showSettings() {
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    modal.classList.add('active');
                    
                    // Load current settings into form
                    const modelSelect = document.getElementById('settingsModel');
                    const themeSelect = document.getElementById('settingsTheme');
                    const notificationsCheck = document.getElementById('settingsNotifications');
                    
                    if (modelSelect) modelSelect.value = this.settings.model;
                    if (themeSelect) themeSelect.value = this.settings.theme;
                    if (notificationsCheck) notificationsCheck.checked = this.settings.notifications;
                }
            }
            
            hideSettings() {
                const modal = document.getElementById('settingsModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }
            
            saveSettings() {
                const modelSelect = document.getElementById('settingsModel');
                const themeSelect = document.getElementById('settingsTheme');
                const notificationsCheck = document.getElementById('settingsNotifications');
                
                if (modelSelect) this.settings.model = modelSelect.value;
                if (themeSelect) this.settings.theme = themeSelect.value;
                if (notificationsCheck) this.settings.notifications = notificationsCheck.checked;
                
                // Update current model display
                const currentModel = document.getElementById('currentModel');
                if (currentModel) {
                    currentModel.textContent = modelSelect?.options[modelSelect.selectedIndex]?.text || 'Gemini 3 Flash';
                }
                
                // Save to localStorage
                localStorage.setItem('promptcraft_settings', JSON.stringify(this.settings));
                
                // Apply theme
                this.applyTheme();
                
                this.hideSettings();
                this.showNotification('Settings saved successfully', 'success');
            }
            
            loadSettings() {
                try {
                    const saved = localStorage.getItem('promptcraft_settings');
                    if (saved) {
                        this.settings = { ...this.settings, ...JSON.parse(saved) };
                    }
                } catch (e) {
                    console.warn('Failed to load settings:', e);
                }
            }
            
            applyTheme() {
                if (this.settings.theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else if (this.settings.theme === 'light') {
                    document.documentElement.setAttribute('data-theme', 'light');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                }
            }
            
            clearInput() {
                const userInput = document.getElementById('userInput');
                const goalInput = document.getElementById('goalInput');
                
                if (userInput) {
                    userInput.value = '';
                    userInput.focus();
                    this.userInput = '';
                    this.updateCharCounter();
                }
                
                if (goalInput) {
                    goalInput.value = '';
                }
                
                this.showNotification('Input cleared', 'info');
            }
            
            maximizeInput() {
                const editor = document.getElementById('fullScreenEditor');
                const editorTextarea = document.getElementById('editorTextarea');
                const userInput = document.getElementById('userInput');
                
                if (editor && editorTextarea && userInput) {
                    editorTextarea.value = userInput.value;
                    editor.classList.add('active');
                    
                    // Focus and move cursor to end
                    setTimeout(() => {
                        editorTextarea.focus();
                        editorTextarea.selectionStart = editorTextarea.value.length;
                        editorTextarea.selectionEnd = editorTextarea.value.length;
                    }, 100);
                }
            }
            
            maximizeOutput() {
                const editor = document.getElementById('fullScreenEditor');
                const editorTextarea = document.getElementById('editorTextarea');
                const outputArea = document.getElementById('outputArea');
                
                if (editor && editorTextarea && outputArea) {
                    editorTextarea.value = outputArea.innerText || outputArea.textContent;
                    editor.classList.add('active');
                    
                    // Focus and move cursor to end
                    setTimeout(() => {
                        editorTextarea.focus();
                        editorTextarea.selectionStart = editorTextarea.value.length;
                        editorTextarea.selectionEnd = editorTextarea.value.length;
                    }, 100);
                }
            }
            
            exitFullScreen() {
                const editor = document.getElementById('fullScreenEditor');
                const editorTextarea = document.getElementById('editorTextarea');
                const userInput = document.getElementById('userInput');
                
                if (editor) {
                    // If we're editing input, update it
                    if (userInput && this.currentStep === 1) {
                        userInput.value = editorTextarea.value;
                        this.userInput = editorTextarea.value;
                        this.updateCharCounter();
                        
                        // Sync with goalInput
                        const goalInput = document.getElementById('goalInput');
                        if (goalInput) goalInput.value = editorTextarea.value;
                    }
                    
                    editor.classList.remove('active');
                }
            }
            
            generateFromEditor() {
                const editorTextarea = document.getElementById('editorTextarea');
                const userInput = document.getElementById('userInput');
                
                if (editorTextarea && userInput) {
                    userInput.value = editorTextarea.value;
                    this.userInput = editorTextarea.value;
                    this.updateCharCounter();
                    
                    // Sync with goalInput
                    const goalInput = document.getElementById('goalInput');
                    if (goalInput) goalInput.value = editorTextarea.value;
                    
                    this.exitFullScreen();
                    this.generatePrompt();
                }
            }
            
            copyOutput() {
                const outputArea = document.getElementById('outputArea');
                if (!outputArea) return;
                
                const text = outputArea.innerText || outputArea.textContent;
                
                if (!text || text.includes('Your generated prompt will appear here')) {
                    this.showNotification('No prompt to copy', 'warning');
                    return;
                }
                
                navigator.clipboard.writeText(text).then(() => {
                    this.showNotification('Prompt copied to clipboard', 'success');
                }).catch(err => {
                    console.error('Copy failed:', err);
                    this.showNotification('Failed to copy', 'error');
                });
            }
            
            selectPlatform(e) {
                const platform = e.currentTarget.dataset.platform;
                const platforms = {
                    gemini: 'https://gemini.google.com',
                    chatgpt: 'https://chat.openai.com',
                    claude: 'https://claude.ai',
                    perplexity: 'https://www.perplexity.ai'
                };
                
                // Get generated prompt
                const outputArea = document.getElementById('outputArea');
                if (!outputArea) {
                    this.showNotification('Please generate a prompt first', 'warning');
                    return;
                }
                
                const prompt = outputArea.innerText || outputArea.textContent;
                if (!prompt || prompt.includes('Your generated prompt will appear here')) {
                    this.showNotification('Please generate a prompt first', 'warning');
                    return;
                }
                
                // Go to step 3
                this.goToStep(3);
                
                // Show platform selection confirmation
                this.showNotification(`Ready to use with ${platform.toUpperCase()}!`, 'success');
                
                // In a real app, you would open the platform with the prompt
                // For now, just show a message
                console.log(`Would open ${platforms[platform]} with prompt`);
            }
            
            resetApp() {
                this.currentStep = 1;
                this.userInput = '';
                this.generatedPrompt = '';
                
                // Clear input
                const userInput = document.getElementById('userInput');
                const goalInput = document.getElementById('goalInput');
                const outputArea = document.getElementById('outputArea');
                const resetBtn = document.getElementById('resetBtn');
                const generateBtn = document.getElementById('generateBtn');
                
                if (userInput) userInput.value = '';
                if (goalInput) goalInput.value = '';
                if (outputArea) outputArea.innerHTML = '<p class="placeholder-text">Your generated prompt will appear here...</p>';
                
                // Hide reset button
                if (resetBtn) resetBtn.style.display = 'none';
                
                // Enable generate button
                if (generateBtn) {
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<i class="fas fa-wand-magic-sparkles"></i> Generate Prompt';
                }
                
                // Hide generation info
                const generationInfo = document.getElementById('generationInfo');
                if (generationInfo) generationInfo.style.display = 'none';
                
                // Go back to step 1
                this.goToStep(1);
                
                // Update character counter
                this.updateCharCounter();
                
                // Focus on input
                if (userInput) userInput.focus();
                
                this.showNotification('App reset successfully', 'info');
            }
            
            updateStepDisplay() {
                this.goToStep(this.currentStep);
            }
            
            showNotification(message, type = 'info', duration = 3000) {
                // Only show if notifications are enabled
                if (!this.settings.notifications && type !== 'error') return;
                
                const container = document.getElementById('notificationContainer');
                if (!container) return;
                
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.cssText = `
                    display: flex;
                    align-items: center;
                    padding: 12px 16px;
                    background: white;
                    border-left: 4px solid ${type === 'success' ? '#10B981' : 
                                         type === 'error' ? '#EF4444' : 
                                         type === 'warning' ? '#F59E0B' : '#4F46E5'};
                    border-radius: 8px;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                    margin-bottom: 10px;
                    max-width: 400px;
                    animation: slideIn 0.3s ease;
                `;
                
                const icon = type === 'success' ? 'check-circle' :
                            type === 'error' ? 'exclamation-circle' :
                            type === 'warning' ? 'exclamation-triangle' : 'info-circle';
                
                notification.innerHTML = `
                    <i class="fas fa-${icon}" style="
                        color: ${type === 'success' ? '#10B981' : 
                                type === 'error' ? '#EF4444' : 
                                type === 'warning' ? '#F59E0B' : '#4F46E5'};
                        margin-right: 12px;
                        font-size: 18px;
                    "></i>
                    <span style="flex: 1; font-size: 14px; color: #374151;">${message}</span>
                    <button onclick="this.parentElement.remove()" style="
                        background: none;
                        border: none;
                        color: #9CA3AF;
                        cursor: pointer;
                        margin-left: 8px;
                        font-size: 16px;
                        padding: 0;
                        line-height: 1;
                    ">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                container.appendChild(notification);
                
                // Auto-remove after duration
                if (duration) {
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, duration);
                }
                
                // Log to console
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
        }
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            window.app = new PromptCraftApp();
            
            // Make app available globally for debugging
            window.PromptCraftApp = PromptCraftApp;
            
            // Simple fallback for showNotification
            window.showNotification = function(message, type, duration) {
                if (window.app) {
                    window.app.showNotification(message, type, duration);
                } else {
                    console.log(`[${type || 'INFO'}] ${message}`);
                }
            };
            
            console.log('PromptCraft Pro v2.0 is ready!');
        });
    </script>
</body>
</html>
