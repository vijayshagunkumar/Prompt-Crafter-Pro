<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptCraft Pro - AI Prompt Engineering Tool</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dark-theme">
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1><i class="fas fa-robot"></i> PromptCraft Pro</h1>
                <p class="tagline">AI-Powered Prompt Engineering Studio</p>
            </div>
            <div class="header-controls">
                <button id="settingsBtn" class="btn btn-secondary">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button id="historyBtn" class="btn btn-secondary">
                    <i class="fas fa-history"></i> History
                </button>
                <button id="themeToggle" class="btn btn-secondary">
                    <i class="fas fa-moon"></i> Theme
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Step 1: Input -->
            <section class="step-section" id="step1">
                <div class="step-header">
                    <h2><span class="step-number">1</span> Describe Your Task</h2>
                    <div class="step-actions">
                        <button class="btn btn-small" id="maximizeStep1">
                            <i class="fas fa-expand"></i> Maximize
                        </button>
                    </div>
                </div>
                <div class="step-content">
                    <div class="input-header">
                        <label for="userInput">
                            <strong>What would you like the AI to help you with?</strong>
                        </label>
                        <button class="btn btn-small btn-inspiration" id="inspirationBtn">
                            <i class="fas fa-lightbulb"></i> Need Inspiration?
                        </button>
                    </div>
                    <div class="textarea-container">
                        <textarea id="userInput" placeholder="Example: Create a marketing campaign for a new eco-friendly water bottle targeting millennials..." rows="6"></textarea>
                        <div class="textarea-actions">
                            <button class="btn btn-small btn-danger" id="clearStep1">
                                <i class="fas fa-times"></i> Clear
                            </button>
                            <div class="char-count">
                                <span id="charCount">0</span> / 3000 characters
                            </div>
                        </div>
                    </div>
                    <div class="style-selector">
                        <label>Prompt Style:</label>
                        <div class="style-buttons">
                            <button class="style-btn active" data-style="detailed">
                                <i class="fas fa-file-alt"></i> Detailed
                            </button>
                            <button class="style-btn" data-style="concise">
                                <i class="fas fa-bolt"></i> Concise
                            </button>
                            <button class="style-btn" data-style="creative">
                                <i class="fas fa-palette"></i> Creative
                            </button>
                            <button class="style-btn" data-style="professional">
                                <i class="fas fa-briefcase"></i> Professional
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 2: Generated Prompt -->
            <section class="step-section" id="step2">
                <div class="step-header">
                    <h2><span class="step-number">2</span> Generated Prompt</h2>
                    <div class="step-actions">
                        <button class="btn btn-small" id="maximizeStep2">
                            <i class="fas fa-expand"></i> Maximize
                        </button>
                        <button class="btn btn-small" id="undoStep2">
                            <i class="fas fa-undo"></i> Undo
                        </button>
                    </div>
                </div>
                <div class="step-content">
                    <div class="prompt-container">
                        <div class="prompt-header">
                            <div class="model-indicator">
                                <i class="fas fa-microchip"></i>
                                <span id="modelName">Google Gemini 3 Flash Preview</span>
                            </div>
                            <div class="prompt-actions">
                                <button class="btn btn-small" id="copyPrompt">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="btn btn-small" id="speakPrompt">
                                    <i class="fas fa-volume-up"></i> Speak
                                </button>
                            </div>
                        </div>
                        <div class="prompt-content" id="generatedPrompt">
                            <p class="placeholder-text">Your generated prompt will appear here after you click "Prepare Prompt"</p>
                        </div>
                        <div class="prompt-footer">
                            <div class="processing-indicator" id="processingIndicator" style="display: none;">
                                <div class="spinner"></div>
                                <span>Generating your prompt...</span>
                            </div>
                            <button class="btn btn-primary btn-large" id="preparePromptBtn">
                                <i class="fas fa-magic"></i> Prepare Prompt
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Settings Modal -->
        <div class="modal-overlay" id="settingsModal" style="display: none;">
            <div class="modal settings-modal">
                <div class="modal-header">
                    <h3><i class="fas fa-cog"></i> Settings & Preferences</h3>
                    <button class="btn-close" id="closeSettings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <!-- Theme Settings -->
                    <div class="settings-section">
                        <h4 class="settings-header"><i class="fas fa-palette"></i> Theme</h4>
                        <div class="settings-group">
                            <div class="setting-item">
                                <label>
                                    <input type="radio" name="theme" value="dark" checked>
                                    <span class="setting-label">Dark Theme</span>
                                </label>
                                <p class="setting-description">Choose your preferred visual theme</p>
                            </div>
                        </div>
                    </div>

                    <!-- UI Density -->
                    <div class="settings-section">
                        <h4 class="settings-header"><i class="fas fa-layer-group"></i> UI Density</h4>
                        <div class="settings-group">
                            <div class="setting-item">
                                <label>
                                    <input type="radio" name="density" value="comfortable" checked>
                                    <span class="setting-label">Comfortable</span>
                                </label>
                                <p class="setting-description">Adjust spacing and density for optimal workflow</p>
                            </div>
                        </div>
                    </div>

                    <!-- AI Model Preferences -->
                    <div class="settings-section">
                        <h4 class="settings-header"><i class="fas fa-brain"></i> AI Model Preferences</h4>
                        <div class="settings-group">
                            <div class="setting-item">
                                <label>
                                    <input type="radio" name="aiModel" value="gemini-3-flash-preview" checked>
                                    <span class="setting-label">Google Gemini 3 Flash Preview</span>
                                </label>
                                <p class="setting-description">Fastest Gemini model, best for creative tasks</p>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="radio" name="aiModel" value="gpt-4o-mini">
                                    <span class="setting-label">OpenAI GPT-4o Mini</span>
                                </label>
                                <p class="setting-description">Cost-effective GPT model for general tasks</p>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="radio" name="aiModel" value="llama-3.1-8b-instant">
                                    <span class="setting-label">Meta Llama 3.1 8B (via Groq)</span>
                                </label>
                                <p class="setting-description">Fast open-source model from Meta</p>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="radio" name="aiModel" value="gemini-1.5-flash-latest">
                                    <span class="setting-label">Google Gemini 1.5 Flash Latest</span>
                                </label>
                                <p class="setting-description">Latest Gemini 1.5 version</p>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="radio" name="aiModel" value="gemini-1.5-flash">
                                    <span class="setting-label">Google Gemini 1.5 Flash</span>
                                </label>
                                <p class="setting-description">Legacy Gemini model</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelSettings">
                        Cancel
                    </button>
                    <button class="btn btn-primary" id="saveSettings" disabled>
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>

        <!-- Maximized View Modal -->
        <div class="modal-overlay" id="maximizedModal" style="display: none;">
            <div class="modal maximized-modal">
                <div class="modal-header">
                    <h3 id="maximizedTitle"></h3>
                    <button class="btn-close" id="closeMaximized">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-content" id="maximizedContent">
                    <!-- Content will be dynamically populated -->
                </div>
                <div class="modal-footer" id="maximizedFooter">
                    <!-- Footer content will be dynamically populated -->
                </div>
            </div>
        </div>

        <!-- Inspiration/Templates Modal -->
        <div class="modal-overlay" id="inspirationModal" style="display: none;">
            <div class="modal inspiration-modal">
                <div class="modal-header">
                    <h3><i class="fas fa-lightbulb"></i> Inspiration & Templates</h3>
                    <button class="btn-close" id="closeInspiration">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <div class="templates-grid">
                        <div class="template-card" data-template="marketing">
                            <h4>Marketing Campaign</h4>
                            <p>Create a marketing campaign for a new product...</p>
                            <button class="btn btn-small use-template">Use</button>
                        </div>
                        <div class="template-card" data-template="content">
                            <h4>Content Creation</h4>
                            <p>Write a blog post about a specific topic...</p>
                            <button class="btn btn-small use-template">Use</button>
                        </div>
                        <div class="template-card" data-template="code">
                            <h4>Code Generation</h4>
                            <p>Generate code for a specific functionality...</p>
                            <button class="btn btn-small use-template">Use</button>
                        </div>
                        <div class="template-card" data-template="creative">
                            <h4>Creative Writing</h4>
                            <p>Write a story or creative piece...</p>
                            <button class="btn btn-small use-template">Use</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <section class="history-section" id="historySection">
            <div class="section-header">
                <h3><i class="fas fa-history"></i> History</h3>
                <button class="btn btn-small" id="clearHistory">
                    <i class="fas fa-trash"></i> Clear All
                </button>
            </div>
            <div class="history-list" id="historyList">
                <!-- History items will be dynamically added here -->
                <div class="history-empty">
                    <i class="fas fa-clock"></i>
                    <p>No history yet. Your prompts will appear here.</p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>PromptCraft Pro v1.0 • Powered by AI • <span id="apiStatus">Connected</span></p>
                <div class="footer-links">
                    <a href="#" class="footer-link">Docs</a>
                    <a href="#" class="footer-link">Support</a>
                    <a href="#" class="footer-link">Privacy</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="js/loader.js"></script>
    <script src="js/utils/constants.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/debounce.js"></script>
    <script src="js/services/storage-service.js"></script>
    <script src="js/services/settings-service.js"></script>
    <script src="js/services/notification-service.js"></script>
    <script src="js/services/api-service.js"></script>
    <script src="js/modules/intent-detector.js"></script>
    <script src="js/modules/prompt-generator.js"></script>
    <script src="js/modules/ai-ranker.js"></script>
    <script src="js/modules/voice-manager.js"></script>
    <script src="js/modules/template-manager.js"></script>
    <script src="js/modules/history-manager.js"></script>
    <script src="js/modules/theme-manager.js"></script>
    <script src="js/core/events.js"></script>
    <script src="js/core/state.js"></script>
    <script src="js/core/app.js"></script>
    
    <!-- Main Application Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the application
            const app = new PromptCraftApp();
            
            // Fix 1: Maximize Button - Full Screen Modal
            document.getElementById('maximizeStep1').addEventListener('click', function() {
                const inputText = document.getElementById('userInput').value;
                const title = "Step 1: Describe Your Task";
                const content = `
                    <div class="maximized-input">
                        <label><strong>What would you like the AI to help you with?</strong></label>
                        <textarea class="maximized-textarea" rows="12">${inputText}</textarea>
                        <div class="maximized-actions">
                            <button class="btn btn-secondary" id="saveMaximizedInput">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </div>
                    </div>
                `;
                openMaximizedView(title, content);
            });
            
            document.getElementById('maximizeStep2').addEventListener('click', function() {
                const promptContent = document.getElementById('generatedPrompt').innerHTML;
                const title = "Step 2: Generated Prompt";
                const content = `
                    <div class="maximized-prompt">
                        <div class="prompt-header">
                            <div class="model-indicator">
                                <i class="fas fa-microchip"></i>
                                <span>${document.getElementById('modelName').textContent}</span>
                            </div>
                        </div>
                        <div class="prompt-content maximized-prompt-content">
                            ${promptContent}
                        </div>
                    </div>
                `;
                const footer = `
                    <div class="maximized-prompt-actions">
                        <button class="btn btn-secondary" id="undoMaximizedPrompt">
                            <i class="fas fa-undo"></i> Undo
                        </button>
                        <button class="btn btn-primary" id="copyMaximizedPrompt">
                            <i class="fas fa-copy"></i> Copy Prompt
                        </button>
                    </div>
                `;
                openMaximizedView(title, content, footer);
            });
            
            function openMaximizedView(title, content, footer = '') {
                document.getElementById('maximizedTitle').textContent = title;
                document.getElementById('maximizedContent').innerHTML = content;
                document.getElementById('maximizedFooter').innerHTML = footer;
                document.getElementById('maximizedModal').style.display = 'block';
                document.body.classList.add('modal-open');
                
                // Add event listeners for maximized view buttons
                if (footer.includes('undoMaximizedPrompt')) {
                    setTimeout(() => {
                        document.getElementById('undoMaximizedPrompt').addEventListener('click', function() {
                            document.getElementById('undoStep2').click();
                            closeMaximizedView();
                        });
                    }, 100);
                }
                
                if (content.includes('saveMaximizedInput')) {
                    setTimeout(() => {
                        document.getElementById('saveMaximizedInput').addEventListener('click', function() {
                            const textarea = document.querySelector('.maximized-textarea');
                            document.getElementById('userInput').value = textarea.value;
                            updateCharCount();
                            closeMaximizedView();
                        });
                    }, 100);
                }
            }
            
            function closeMaximizedView() {
                document.getElementById('maximizedModal').style.display = 'none';
                document.body.classList.remove('modal-open');
            }
            
            document.getElementById('closeMaximized').addEventListener('click', closeMaximizedView);
            
            // Fix 2: Need Inspiration Button - Functionality & Placement
            document.getElementById('inspirationBtn').addEventListener('click', function() {
                document.getElementById('inspirationModal').style.display = 'block';
                document.body.classList.add('modal-open');
            });
            
            document.getElementById('closeInspiration').addEventListener('click', function() {
                document.getElementById('inspirationModal').style.display = 'none';
                document.body.classList.remove('modal-open');
            });
            
            // Template selection
            document.querySelectorAll('.use-template').forEach(button => {
                button.addEventListener('click', function() {
                    const templateCard = this.closest('.template-card');
                    const templateType = templateCard.dataset.template;
                    const templates = {
                        marketing: "Create a marketing campaign for a new eco-friendly product targeting millennials. Include social media strategy, influencer partnerships, and key messaging.",
                        content: "Write a comprehensive blog post about the benefits of meditation for mental health. Include scientific references, practical tips, and personal anecdotes.",
                        code: "Generate a Python function that takes a list of numbers and returns statistics including mean, median, mode, and standard deviation.",
                        creative: "Write a short story about a character who discovers they can communicate with animals. Include dialogue, character development, and a moral lesson."
                    };
                    
                    document.getElementById('userInput').value = templates[templateType] || '';
                    updateCharCount();
                    document.getElementById('inspirationModal').style.display = 'none';
                    document.body.classList.remove('modal-open');
                    
                    // Auto-scroll to textarea
                    document.getElementById('userInput').focus();
                    document.getElementById('userInput').scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            });
            
            // Fix 3: Clear Text Button (Step 1)
            document.getElementById('clearStep1').addEventListener('click', function() {
                document.getElementById('userInput').value = '';
                document.getElementById('generatedPrompt').innerHTML = 
                    '<p class="placeholder-text">Your generated prompt will appear here after you click "Prepare Prompt"</p>';
                document.getElementById('preparePromptBtn').innerHTML = 
                    '<i class="fas fa-magic"></i> Prepare Prompt';
                document.getElementById('preparePromptBtn').classList.remove('btn-reset');
                updateCharCount();
                
                // Reset style buttons
                document.querySelectorAll('.style-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.style-btn[data-style="detailed"]').classList.add('active');
            });
            
            // Character count
            function updateCharCount() {
                const textarea = document.getElementById('userInput');
                const count = textarea.value.length;
                document.getElementById('charCount').textContent = count;
                
                if (count > 3000) {
                    document.getElementById('charCount').style.color = '#ff6b6b';
                } else if (count > 2500) {
                    document.getElementById('charCount').style.color = '#ffa726';
                } else {
                    document.getElementById('charCount').style.color = '';
                }
            }
            
            document.getElementById('userInput').addEventListener('input', updateCharCount);
            
            // Fix 4: Prepare Prompt Button Visibility (Step 2 Maximized)
            // Already handled in the maximizeStep2 function - Prepare Prompt button is not included in maximized view
            
            // Fix 5: Undo Button in Step 2 (Maximized View)
            // Already handled in the maximizeStep2 function - Undo button works in both views
            
            let lastPromptState = '';
            document.getElementById('undoStep2').addEventListener('click', function() {
                const promptElement = document.getElementById('generatedPrompt');
                if (lastPromptState) {
                    promptElement.innerHTML = lastPromptState;
                    lastPromptState = '';
                    this.style.opacity = '0.5';
                    this.disabled = true;
                }
            });
            
            // Fix 6: Processing Loader / Status Feedback
            document.getElementById('preparePromptBtn').addEventListener('click', async function() {
                const inputText = document.getElementById('userInput').value.trim();
                if (!inputText) {
                    alert('Please enter some text in Step 1 first.');
                    return;
                }
                
                // Show processing indicator
                const indicator = document.getElementById('processingIndicator');
                const btn = this;
                const originalText = btn.innerHTML;
                
                indicator.style.display = 'flex';
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                btn.disabled = true;
                
                try {
                    // Get selected style
                    const selectedStyle = document.querySelector('.style-btn.active').dataset.style;
                    
                    // Get selected model from settings
                    const selectedModel = document.querySelector('input[name="aiModel"]:checked').value;
                    const modelDisplayNames = {
                        'gemini-3-flash-preview': 'Google Gemini 3 Flash Preview',
                        'gpt-4o-mini': 'OpenAI GPT-4o Mini',
                        'llama-3.1-8b-instant': 'Meta Llama 3.1 8B (via Groq)',
                        'gemini-1.5-flash-latest': 'Google Gemini 1.5 Flash Latest',
                        'gemini-1.5-flash': 'Google Gemini 1.5 Flash'
                    };
                    
                    document.getElementById('modelName').textContent = modelDisplayNames[selectedModel] || 'Google Gemini 3 Flash Preview';
                    
                    // Simulate API call with loading
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // In a real implementation, you would call your ApiService here
                    // const apiService = new ApiService();
                    // const result = await apiService.generatePrompt(inputText, selectedStyle);
                    
                    // For demo purposes, generate a mock prompt
                    const mockPrompt = generateMockPrompt(inputText, selectedStyle);
                    
                    // Save current state for undo
                    lastPromptState = document.getElementById('generatedPrompt').innerHTML;
                    document.getElementById('undoStep2').style.opacity = '1';
                    document.getElementById('undoStep2').disabled = false;
                    
                    // Display the generated prompt
                    document.getElementById('generatedPrompt').innerHTML = `
                        <div class="prompt-result">
                            <h4>Generated Prompt:</h4>
                            <div class="prompt-text">${mockPrompt}</div>
                            <div class="prompt-meta">
                                <span class="meta-item"><i class="fas fa-clock"></i> ${new Date().toLocaleTimeString()}</span>
                                <span class="meta-item"><i class="fas fa-style"></i> ${selectedStyle.charAt(0).toUpperCase() + selectedStyle.slice(1)}</span>
                            </div>
                        </div>
                    `;
                    
                    // Fix 7: Prepare Prompt → Reset Button Behavior
                    btn.innerHTML = '<i class="fas fa-redo"></i> Reset';
                    btn.classList.add('btn-reset');
                    
                    // Add to history
                    addToHistory(inputText, mockPrompt, selectedStyle);
                    
                } catch (error) {
                    console.error('Error generating prompt:', error);
                    document.getElementById('generatedPrompt').innerHTML = `
                        <div class="prompt-error">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h4>Error Generating Prompt</h4>
                            <p>There was an issue generating your prompt. Please try again.</p>
                        </div>
                    `;
                } finally {
                    // Hide processing indicator
                    indicator.style.display = 'none';
                    btn.disabled = false;
                }
            });
            
            // Fix 7 continued: Reset button behavior
            document.addEventListener('click', function(e) {
                const btn = document.getElementById('preparePromptBtn');
                if (btn.classList.contains('btn-reset') && e.target === btn) {
                    document.getElementById('clearStep1').click();
                    btn.innerHTML = '<i class="fas fa-magic"></i> Prepare Prompt';
                    btn.classList.remove('btn-reset');
                }
            });
            
            // Fix 8: Settings Header Color (Dark Theme)
            // This is handled in CSS - see below
            
            // Fix 9: Save Settings Button
            let settingsChanged = false;
            const settingsInputs = document.querySelectorAll('#settingsModal input');
            const saveSettingsBtn = document.getElementById('saveSettings');
            
            settingsInputs.forEach(input => {
                input.addEventListener('change', function() {
                    settingsChanged = true;
                    saveSettingsBtn.disabled = false;
                });
            });
            
            saveSettingsBtn.addEventListener('click', function() {
                if (!settingsChanged) return;
                
                // Get selected settings
                const theme = document.querySelector('input[name="theme"]:checked').value;
                const density = document.querySelector('input[name="density"]:checked').value;
                const aiModel = document.querySelector('input[name="aiModel"]:checked').value;
                
                // Save to localStorage
                localStorage.setItem('promptcraft_settings', JSON.stringify({
                    theme,
                    density,
                    aiModel,
                    lastUpdated: new Date().toISOString()
                }));
                
                // Apply settings
                document.body.className = theme + '-theme';
                
                // Update model indicator
                const modelDisplayNames = {
                    'gemini-3-flash-preview': 'Google Gemini 3 Flash Preview',
                    'gpt-4o-mini': 'OpenAI GPT-4o Mini',
                    'llama-3.1-8b-instant': 'Meta Llama 3.1 8B (via Groq)',
                    'gemini-1.5-flash-latest': 'Google Gemini 1.5 Flash Latest',
                    'gemini-1.5-flash': 'Google Gemini 1.5 Flash'
                };
                document.getElementById('modelName').textContent = modelDisplayNames[aiModel] || 'Google Gemini 3 Flash Preview';
                
                // Reset state
                settingsChanged = false;
                saveSettingsBtn.disabled = true;
                
                // Close modal
                document.getElementById('closeSettings').click();
                
                // Show confirmation
                alert('Settings saved successfully!');
            });
            
            document.getElementById('cancelSettings').addEventListener('click', function() {
                settingsChanged = false;
                saveSettingsBtn.disabled = true;
                document.getElementById('closeSettings').click();
            });
            
            // Settings modal controls
            document.getElementById('settingsBtn').addEventListener('click', function() {
                // Load saved settings
                const savedSettings = JSON.parse(localStorage.getItem('promptcraft_settings') || '{}');
                
                if (savedSettings.theme) {
                    document.querySelector(`input[name="theme"][value="${savedSettings.theme}"]`).checked = true;
                }
                if (savedSettings.density) {
                    document.querySelector(`input[name="density"][value="${savedSettings.density}"]`).checked = true;
                }
                if (savedSettings.aiModel) {
                    document.querySelector(`input[name="aiModel"][value="${savedSettings.aiModel}"]`).checked = true;
                }
                
                document.getElementById('settingsModal').style.display = 'block';
                document.body.classList.add('modal-open');
            });
            
            document.getElementById('closeSettings').addEventListener('click', function() {
                document.getElementById('settingsModal').style.display = 'none';
                document.body.classList.remove('modal-open');
            });
            
            // Fix 10: History Navigation & Reusability
            document.getElementById('historyBtn').addEventListener('click', function() {
                document.getElementById('historySection').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            });
            
            function addToHistory(inputText, generatedPrompt, style) {
                const historyList = document.getElementById('historyList');
                const emptyState = historyList.querySelector('.history-empty');
                
                if (emptyState) {
                    emptyState.remove();
                }
                
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-item-content">
                        <div class="history-input">
                            <strong>Input:</strong> ${inputText.substring(0, 100)}${inputText.length > 100 ? '...' : ''}
                        </div>
                        <div class="history-meta">
                            <span class="history-style">${style}</span>
                            <span class="history-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                        </div>
                    </div>
                    <div class="history-item-actions">
                        <button class="btn btn-small btn-reuse" title="Reuse this prompt">
                            <i class="fas fa-arrow-up"></i> Reuse
                        </button>
                        <button class="btn btn-small btn-delete" title="Delete from history">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                // Add reuse functionality
                const reuseBtn = historyItem.querySelector('.btn-reuse');
                reuseBtn.addEventListener('click', function() {
                    document.getElementById('userInput').value = inputText;
                    updateCharCount();
                    document.getElementById('generatedPrompt').innerHTML = `
                        <div class="prompt-result">
                            <h4>Generated Prompt:</h4>
                            <div class="prompt-text">${generatedPrompt}</div>
                            <div class="prompt-meta">
                                <span class="meta-item"><i class="fas fa-clock"></i> ${new Date().toLocaleTimeString()}</span>
                                <span class="meta-item"><i class="fas fa-style"></i> ${style.charAt(0).toUpperCase() + style.slice(1)}</span>
                            </div>
                        </div>
                    `;
                    
                    // Update Prepare Prompt button to Reset
                    const prepareBtn = document.getElementById('preparePromptBtn');
                    prepareBtn.innerHTML = '<i class="fas fa-redo"></i> Reset';
                    prepareBtn.classList.add('btn-reset');
                    
                    // Scroll to Step 1
                    document.getElementById('step1').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Focus on textarea
                    document.getElementById('userInput').focus();
                });
                
                // Add delete functionality
                const deleteBtn = historyItem.querySelector('.btn-delete');
                deleteBtn.addEventListener('click', function() {
                    historyItem.remove();
                    
                    // Show empty state if no items left
                    if (historyList.children.length === 0) {
                        historyList.innerHTML = `
                            <div class="history-empty">
                                <i class="fas fa-clock"></i>
                                <p>No history yet. Your prompts will appear here.</p>
                            </div>
                        `;
                    }
                });
                
                historyList.prepend(historyItem);
            }
            
            // Clear history button
            document.getElementById('clearHistory').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all history?')) {
                    document.getElementById('historyList').innerHTML = `
                        <div class="history-empty">
                            <i class="fas fa-clock"></i>
                            <p>No history yet. Your prompts will appear here.</p>
                        </div>
                    `;
                }
            });
            
            // Style buttons
            document.querySelectorAll('.style-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Copy prompt button
            document.getElementById('copyPrompt').addEventListener('click', function() {
                const promptText = document.querySelector('.prompt-text')?.textContent || 
                                 document.getElementById('generatedPrompt').textContent;
                
                if (promptText && !promptText.includes('Your generated prompt will appear here')) {
                    navigator.clipboard.writeText(promptText).then(() => {
                        const originalText = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        setTimeout(() => {
                            this.innerHTML = originalText;
                        }, 2000);
                    });
                }
            });
            
            // Helper function to generate mock prompts
            function generateMockPrompt(input, style) {
                const styles = {
                    detailed: `You are an expert AI assistant. Based on the user request: "${input}"

Please create a comprehensive and detailed response that includes:

1. **Role Definition**: Specify the exact role you should embody
2. **Core Objective**: Clearly state the main goal
3. **Key Components**: Break down into essential elements
4. **Step-by-Step Process**: Provide actionable steps
5. **Best Practices**: Include industry standards and tips
6. **Expected Output**: Describe the final deliverable
7. **Quality Criteria**: List success metrics and evaluation criteria

Format the response in a structured, professional manner with clear headings and bullet points where appropriate.`,
                    
                    concise: `Task: ${input}

Provide a direct, focused response with clear, actionable instructions. Keep it brief but comprehensive.`,
                    
                    creative: `Creative Request: ${input}

Approach this with imagination and innovation. Use engaging language, incorporate storytelling elements, and focus on unique perspectives. Be inspiring and original in your response structure.`,
                    
                    professional: `Professional Assignment: ${input}

Prepare a formal, business-appropriate response structured as:

• Executive Summary
• Background Context
• Strategic Analysis
• Implementation Plan
• Risk Assessment
• Next Steps
• Success Metrics

Use professional tone and corporate formatting.`
                };
                
                return styles[style] || styles.detailed;
            }
            
            // Initialize
            updateCharCount();
            
            // Load saved settings
            const savedSettings = JSON.parse(localStorage.getItem('promptcraft_settings') || '{}');
            if (savedSettings.theme) {
                document.body.className = savedSettings.theme + '-theme';
            }
            if (savedSettings.aiModel) {
                const modelDisplayNames = {
                    'gemini-3-flash-preview': 'Google Gemini 3 Flash Preview',
                    'gpt-4o-mini': 'OpenAI GPT-4o Mini',
                    'llama-3.1-8b-instant': 'Meta Llama 3.1 8B (via Groq)',
                    'gemini-1.5-flash-latest': 'Google Gemini 1.5 Flash Latest',
                    'gemini-1.5-flash': 'Google Gemini 1.5 Flash'
                };
                document.getElementById('modelName').textContent = modelDisplayNames[savedSettings.aiModel] || 'Google Gemini 3 Flash Preview';
            }
        });
    </script>

    <!-- CSS Styles -->
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #334155;
        }
        
        .logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .tagline {
            color: #94a3b8;
            font-size: 1rem;
        }
        
        .header-controls {
            display: flex;
            gap: 10px;
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: #334155;
            color: #cbd5e1;
            border: 1px solid #475569;
        }
        
        .btn-secondary:hover {
            background: #475569;
            border-color: #64748b;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .btn-large {
            padding: 15px 30px;
            font-size: 16px;
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .btn-inspiration {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        /* Step Sections */
        .step-section {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #334155;
            border-radius: 12px;
            margin-bottom: 30px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .step-header {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            padding: 20px;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .step-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            color: #e2e8f0;
        }
        
        .step-number {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .step-content {
            padding: 25px;
        }
        
        /* Input Section */
        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .input-header label {
            font-size: 1.1rem;
            color: #cbd5e1;
        }
        
        .textarea-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        
        .textarea-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .char-count {
            color: #94a3b8;
            font-size: 14px;
        }
        
        /* Style Selector */
        .style-selector {
            margin-top: 20px;
        }
        
        .style-selector label {
            display: block;
            margin-bottom: 10px;
            color: #cbd5e1;
            font-weight: 600;
        }
        
        .style-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .style-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            background: #334155;
            border: 1px solid #475569;
            color: #cbd5e1;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .style-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }
        
        .style-btn:hover:not(.active) {
            background: #475569;
            transform: translateY(-1px);
        }
        
        /* Prompt Container */
        .prompt-container {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .prompt-header {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            padding: 15px 20px;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .model-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #60a5fa;
            font-weight: 600;
        }
        
        .prompt-content {
            padding: 25px;
            min-height: 200px;
            background: #0f172a;
        }
        
        .placeholder-text {
            color: #64748b;
            text-align: center;
            padding: 40px 20px;
            font-style: italic;
        }
        
        .prompt-result {
            background: #1e293b;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #60a5fa;
        }
        
        .prompt-result h4 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .prompt-text {
            color: #cbd5e1;
            line-height: 1.8;
            white-space: pre-wrap;
            margin-bottom: 15px;
        }
        
        .prompt-meta {
            display: flex;
            gap: 20px;
            color: #94a3b8;
            font-size: 14px;
        }
        
        .prompt-footer {
            padding: 20px;
            background: #1e293b;
            border-top: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .processing-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #60a5fa;
            font-weight: 600;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(96, 165, 250, 0.3);
            border-top-color: #60a5fa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 16px;
            border: 1px solid #334155;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: #e2e8f0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-close {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s ease;
        }
        
        .btn-close:hover {
            color: #e2e8f0;
        }
        
        .modal-content {
            padding: 30px;
            max-height: calc(90vh - 150px);
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #334155;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            background: rgba(15, 23, 42, 0.7);
        }
        
        /* Maximized Modal */
        .maximized-modal {
            max-width: 95%;
            max-height: 95vh;
        }
        
        .maximized-modal .modal-content {
            max-height: calc(95vh - 150px);
        }
        
        .maximized-textarea {
            width: 100%;
            min-height: 400px;
            font-size: 18px;
            line-height: 1.8;
            background: #0f172a;
            border: 1px solid #475569;
            color: #e2e8f0;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .maximized-prompt-content {
            font-size: 18px;
            line-height: 1.8;
            background: #0f172a;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .maximized-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* Settings Modal - Fix 8: Header Color */
        .settings-header {
            color: #cbd5e1 !important; /* Changed from blue to dark-theme-friendly color */
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #334155;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .settings-section {
            margin-bottom: 30px;
        }
        
        .setting-item {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .setting-item:hover {
            background: #273449;
            border-color: #475569;
        }
        
        .setting-item label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: #e2e8f0;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .setting-description {
            color: #94a3b8;
            font-size: 14px;
            margin-left: 26px;
        }
        
        /* Inspiration Modal */
        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .template-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border-color: #475569;
        }
        
        .template-card h4 {
            color: #60a5fa;
            font-size: 1.1rem;
        }
        
        .template-card p {
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.5;
            flex-grow: 1;
        }
        
        /* History Section */
        .history-section {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #334155;
            border-radius: 12px;
            margin-top: 40px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #334155;
        }
        
        .section-header h3 {
            color: #e2e8f0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }
        
        .history-empty i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .history-item {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .history-item:hover {
            background: #273449;
            border-color: #475569;
            transform: translateX(5px);
        }
        
        .history-item-content {
            flex-grow: 1;
        }
        
        .history-input {
            color: #cbd5e1;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .history-meta {
            display: flex;
            gap: 20px;
            color: #94a3b8;
            font-size: 13px;
        }
        
        .history-style {
            background: #334155;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: capitalize;
        }
        
        .history-item-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-reuse {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-reuse:hover {
            background: linear-gradient(135deg, #0da271 0%, #047857 100%);
        }
        
        /* Footer */
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #334155;
            color: #94a3b8;
            font-size: 14px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #apiStatus {
            color: #10b981;
            font-weight: 600;
        }
        
        .footer-links {
            display: flex;
            gap: 20px;
        }
        
        .footer-link {
            color: #94a3b8;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-link:hover {
            color: #60a5fa;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
            }
            
            .style-buttons {
                flex-direction: column;
            }
            
            .modal {
                width: 95%;
            }
            
            .templates-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
        
        /* Modal Open State */
        body.modal-open {
            overflow: hidden;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</body>
</html>
