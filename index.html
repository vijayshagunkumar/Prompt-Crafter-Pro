<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Turn rough ideas into ready-to-run AI prompts. We prepare the perfect prompt and open it in the best AI tool.">
    <meta name="theme-color" content="#3b82f6">
    <title>PromptCraft - Your AI Task Assistant</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ñ</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes highlightPulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 20px 10px rgba(59, 130, 246, 0.3);
                transform: scale(1.02);
            }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slideUp {
            animation: slideUp 0.4s ease-out;
        }
        
        .animate-highlight {
            animation: highlightPulse 1.5s ease-in-out;
        }
        
        /* Components */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .card.highlight {
            border-color: #3b82f6;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }
        
        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .card.hidden {
            display: none;
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            font-size: 1rem;
            position: relative;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: white;
            color: #4b5563;
            border: 1px solid #d1d5db;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #f9fafb;
            border-color: #9ca3af;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .btn-secondary:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Chips */
        .chip {
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            color: #3730a3;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .chip:hover:not(:disabled) {
            background: linear-gradient(135deg, #c7d2fe, #a5b4fc);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(55, 48, 163, 0.15);
        }
        
        .chip:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        .chip.active {
            background: linear-gradient(135deg, #3730a3, #312e81);
            color: white;
        }
        
        /* Output Area */
        .output-area {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            min-height: 120px;
            position: relative;
            overflow-y: auto;
        }
        
        .output-area.maximized {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            border-radius: 0;
            padding: 80px 40px 40px;
            font-size: 1.1rem;
            background: white;
            border: none;
            box-shadow: none;
            animation: fadeIn 0.2s ease-out;
        }
        
        /* Confidence Badge */
        .confidence-badge {
            display: inline-block;
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #14532d;
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 12px;
            margin-left: 8px;
            font-weight: 600;
            letter-spacing: 0.02em;
        }
        
        /* Loading Animation */
        .loading-dots {
            display: inline-block;
            position: relative;
            width: 20px;
            height: 20px;
        }
        
        .loading-dots div {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: white;
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }
        
        .loading-dots div:nth-child(1) {
            left: 4px;
            animation: loading-dots1 0.6s infinite;
        }
        
        .loading-dots div:nth-child(2) {
            left: 4px;
            animation: loading-dots2 0.6s infinite;
        }
        
        .loading-dots div:nth-child(3) {
            left: 16px;
            animation: loading-dots2 0.6s infinite;
        }
        
        .loading-dots div:nth-child(4) {
            left: 28px;
            animation: loading-dots3 0.6s infinite;
        }
        
        @keyframes loading-dots1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
        
        @keyframes loading-dots3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }
        
        @keyframes loading-dots2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(12px, 0); }
        }
        
        /* Error Banner */
        .error-banner {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 1px solid #fecaca;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            animation: slideUp 0.3s ease-out;
        }
        
        .error-banner.warning {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            border-color: #fde68a;
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            font-size: 0.75rem;
            padding: 6px 12px;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .status-badge.ready {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #14532d;
        }
        
        /* Step Indicator */
        .step-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .step-dot.active {
            background: #3b82f6;
            transform: scale(1.3);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .step-dot.completed {
            background: #10b981;
            transform: scale(1);
        }
        
        /* Accordion */
        .accordion-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out, margin 0.3s ease-out;
            margin: 0;
            padding: 0;
        }
        
        .accordion-content.expanded {
            max-height: 500px;
            opacity: 1;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        /* Textarea */
        .maximizable-textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
            min-height: 150px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .maximizable-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .maximizable-textarea.maximized {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            border-radius: 0;
            padding: 80px 40px 40px;
            font-size: 1.1rem;
            background: white;
            border: none;
            resize: none;
            animation: fadeIn 0.2s ease-out;
        }
        
        /* Settings Modal */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.2s ease-out;
        }
        
        .settings-modal.active {
            display: flex;
        }
        
        .settings-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        /* Settings Toggle Button */
        .settings-toggle {
            position: fixed;
            top: 16px;
            right: 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .settings-toggle:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            transform: scale(1.1);
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-help {
            margin-top: 4px;
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .toggle-switch.active {
            background: #3b82f6;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .toggle-switch.active::after {
            transform: translateX(20px);
        }
        
        /* Model Tag */
        .model-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 8px;
        }
        
        .model-tag.free {
            background: #d1fae5;
            color: #065f46;
        }
        
        .model-tag.paid {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* Progress Line */
        .progress-line {
            height: 3px;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            border-radius: 2px;
            transition: width 0.5s ease;
        }
        
        /* Focus Styles */
        *:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-indigo-50 min-h-screen p-4 md:p-8">
    <!-- Settings Toggle Button -->
    <button id="settingsToggle" class="settings-toggle" aria-label="Settings" title="Settings">
        ‚öôÔ∏è
    </button>
    
    <div class="max-w-2xl mx-auto">
        <!-- Progress indicator -->
        <div class="sticky top-2 z-10 mb-6 bg-white/80 backdrop-blur-sm rounded-full p-1 shadow-sm">
            <div id="progressLine" class="progress-line w-0"></div>
        </div>
        
        <!-- Settings Modal -->
        <div id="settingsModal" class="settings-modal">
            <div class="settings-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-900">‚öôÔ∏è Settings</h2>
                    <button id="closeSettings" class="text-gray-500 hover:text-gray-700 text-2xl" aria-label="Close settings">
                        &times;
                    </button>
                </div>
                
                <!-- AI Model Selection -->
                <div class="form-group">
                    <label for="aiModel" class="form-label">ü§ñ Default AI Model</label>
                    <select id="aiModel" class="form-select">
                        <option value="gemini">Gemini Pro <span class="model-tag free">Free</span></option>
                        <option value="chatgpt">ChatGPT <span class="model-tag paid">Pro</span></option>
                        <option value="claude">Claude 3.5 <span class="model-tag paid">Pro</span></option>
                        <option value="llama">LLaMA 3.1 <span class="model-tag free">Free</span></option>
                        <option value="grok">Grok <span class="model-tag paid">Pro</span></option>
                    </select>
                    <div class="form-help">
                        This model will be used when generating prompts
                    </div>
                </div>
                
                <!-- Prompt Style -->
                <div class="form-group">
                    <label for="promptStyle" class="form-label">üé® Default Prompt Style</label>
                    <select id="promptStyle" class="form-select">
                        <option value="detailed">Detailed & Structured</option>
                        <option value="concise">Concise & Direct</option>
                        <option value="creative">Creative & Engaging</option>
                        <option value="analytical">Analytical & Data-Driven</option>
                    </select>
                    <div class="form-help">
                        Controls how prompts are formatted by default
                    </div>
                </div>
                
                <!-- Auto-Convert -->
                <div class="toggle-container">
                    <div>
                        <div class="font-medium text-gray-800">‚ö° Auto-Convert</div>
                        <div class="text-sm text-gray-600">Automatically generate prompts after typing</div>
                    </div>
                    <div id="autoConvertToggle" class="toggle-switch"></div>
                </div>
                
                <!-- Voice Input -->
                <div class="toggle-container">
                    <div>
                        <div class="font-medium text-gray-800">üé§ Voice Input</div>
                        <div class="text-sm text-gray-600">Allow voice input for tasks</div>
                    </div>
                    <div id="voiceInputToggle" class="toggle-switch"></div>
                </div>
                
                <!-- Reset Button -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <button id="resetSettings" class="btn-secondary w-full">
                        üîÑ Reset to Defaults
                    </button>
                </div>
                
                <!-- Save Button -->
                <div class="mt-4">
                    <button id="saveSettings" class="btn-primary w-full">
                        üíæ Save Settings
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Header -->
        <div id="headerSection" class="text-center mb-6 relative">
            <div class="inline-block bg-white/90 backdrop-blur-sm rounded-2xl px-4 py-2 mb-3 shadow-sm">
                <span class="text-xs font-semibold text-blue-600 uppercase tracking-wider">AI Prompt Orchestration</span>
            </div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">
                Ready-to-Run AI Prompts
            </h1>
            <p class="text-gray-700 text-base max-w-2xl mx-auto bg-white/80 backdrop-blur-sm rounded-xl py-2 px-4 inline-block shadow-sm">
                Describe your task. We prepare the perfect prompt and open it in the best AI tool.
            </p>
        </div>

        <!-- Card 1: Input -->
        <div id="step1Card" class="card">
            <div class="step-indicator">
                <div class="step-dot active" role="presentation"></div>
                <div class="text-sm font-medium text-gray-700">Step 1: Describe your task</div>
            </div>
            
            <h2 class="text-lg font-semibold text-gray-800 mb-4 mt-2">
                What do you want to do?
            </h2>
            
            <!-- Textarea -->
            <textarea 
                id="userInput"
                class="maximizable-textarea"
                placeholder="e.g., 'Write a professional email to decline a meeting politely'"
                rows="4"
                aria-label="Describe your task"
            ></textarea>
            
            <!-- Character count -->
            <div class="text-xs text-gray-500 mt-2 text-right">
                <span id="charCountValue">0</span> characters
            </div>
            
            <!-- Example chips -->
            <div class="flex flex-wrap gap-2 sm:gap-3 mt-4" role="group" aria-label="Example prompts">
                <button class="chip" data-type="email">
                    ‚úâÔ∏è Email
                </button>
                <button class="chip" data-type="code">
                    üíª Code
                </button>
                <button class="chip" data-type="analysis">
                    üìä Analysis
                </button>
                <button class="chip" data-type="creative">
                    üé® Creative
                </button>
            </div>
            
            <!-- Primary CTA -->
            <button 
                id="prepareBtn"
                class="btn-primary mt-6"
            >
                <span id="btnText">Prepare Prompt</span>
                <div id="btnLoading" class="loading-dots hidden absolute right-6 top-1/2 transform -translate-y-1/2">
                    <div></div><div></div><div></div><div></div>
                </div>
            </button>
        </div>

        <!-- Card 2: Output -->
        <div id="outputCard" class="card hidden">
            <div class="step-indicator">
                <div class="step-dot completed" role="presentation"></div>
                <div class="step-dot active" role="presentation"></div>
                <div class="text-sm font-medium text-gray-700">Step 2: Ready prompt</div>
            </div>
            
            <div class="flex justify-between items-center mb-4 mt-2">
                <h2 class="text-lg font-semibold text-gray-800">
                    READY-TO-USE PROMPT
                </h2>
                <span class="status-badge ready">
                    <span class="text-xs">‚úì</span>
                    <span>Ready</span>
                </span>
            </div>
            
            <p class="text-sm text-gray-600 mb-4">
                You can copy this or open directly in AI tools
            </p>
            
            <!-- Output area -->
            <div id="outputArea" class="output-area" role="region" aria-label="Generated prompt">
                Your optimized prompt will appear here...
            </div>
            
            <div class="flex flex-col sm:flex-row gap-3 mt-6">
                <button id="useInAI" class="btn-primary flex-1">
                    üöÄ Use this in AI
                </button>
                <button id="copyBtn" class="btn-secondary">
                    üìã Copy Prompt
                </button>
            </div>
        </div>

        <!-- Card 3: AI Tools -->
        <div id="aiCard" class="card hidden">
            <div class="step-indicator">
                <div class="step-dot completed" role="presentation"></div>
                <div class="step-dot completed" role="presentation"></div>
                <div class="step-dot active" role="presentation"></div>
                <div class="text-sm font-medium text-gray-700">Step 3: Choose AI tool</div>
            </div>
            
            <h2 class="text-lg font-semibold text-gray-800 mb-4 mt-2">
                OPEN IN AI TOOL
            </h2>
            <p class="text-sm text-gray-600 mb-2 text-center">
                We choose the AI based on your task type and complexity
            </p>
            
            <!-- Primary Recommended Button -->
            <div class="mb-6">
                <button id="bestAIButton" class="btn-primary w-full py-4 text-lg">
                    <!-- Dynamic content will appear here -->
                </button>
                <!-- "Why" explanation line -->
                <p id="aiExplanation" class="text-xs text-gray-500 mt-3 text-center">
                    Chosen based on task type and complexity
                </p>
            </div>
            
            <!-- Secondary Options -->
            <div class="text-center">
                <button 
                    id="otherToolsToggle"
                    class="text-sm text-gray-500 hover:text-gray-700 mb-3 transition-colors"
                >
                    <span id="toolsIcon">‚ñæ</span>
                    <span>Other AI tools</span>
                </button>
                
                <!-- Other AI Tools -->
                <div id="otherTools" class="accordion-content">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <button class="btn-secondary ai-tool-btn" data-model="chatgpt">
                            ChatGPT
                        </button>
                        <button class="btn-secondary ai-tool-btn" data-model="gemini">
                            Gemini Pro
                        </button>
                        <button class="btn-secondary ai-tool-btn" data-model="claude">
                            Claude 3.5
                        </button>
                        <button class="btn-secondary ai-tool-btn" data-model="llama">
                            LLaMA 3.1
                        </button>
                        <button class="btn-secondary ai-tool-btn" data-model="grok">
                            Grok (xAI)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-gray-500 text-sm">
            <div class="flex flex-col sm:flex-row justify-center items-center gap-2">
                <span>PromptCraft ‚Äî your AI task assistant</span>
                <span class="hidden sm:inline">‚Ä¢</span>
                <span>Ready for production</span>
            </div>
        </div>
    </div>

    <script>
        // PromptCraft Application - With Settings
        const PromptCraft = (() => {
            // Configuration
            const CONFIG = {
                AUTO_CONVERT_DELAY: 3000,
                PROMPT_GENERATION_DELAY: 1200,
                STORAGE_KEYS: {
                    SETTINGS: 'promptcraft_settings',
                    INPUT: 'promptcraft_input',
                    VISITED: 'promptcraft_visited'
                },
                MODEL_CONFIG: {
                    chatgpt: {
                        name: 'ChatGPT',
                        url: 'https://chat.openai.com/',
                        strengths: ['creative writing', 'conversation', 'general tasks', 'email'],
                        explanation: 'Best for creative and conversational tasks',
                        isFree: false
                    },
                    gemini: {
                        name: 'Gemini Pro',
                        url: 'https://gemini.google.com/',
                        strengths: ['analysis', 'research', 'data', 'reasoning'],
                        explanation: 'Best for analysis and data-driven tasks',
                        isFree: true
                    },
                    claude: {
                        name: 'Claude 3.5',
                        url: 'https://claude.ai/',
                        strengths: ['code', 'long reasoning', 'document analysis', 'structured'],
                        explanation: 'Best for coding and complex reasoning',
                        isFree: false
                    },
                    llama: {
                        name: 'LLaMA 3.1',
                        url: 'https://llama.meta.com/',
                        strengths: ['fast response', 'general', 'summarization'],
                        explanation: 'Fast and reliable for general tasks',
                        isFree: true
                    },
                    grok: {
                        name: 'Grok',
                        url: 'https://x.ai/',
                        strengths: ['humor', 'real-time', 'sarcasm', 'news'],
                        explanation: 'Best for humor and real-time information',
                        isFree: false
                    }
                },
                INTENT_TEMPLATES: {
                    detailed: `You are a professional assistant with expertise in this domain. Your task:\n\n{input}\n\nPlease provide:\n1. Clear, structured response\n2. Practical implementation\n3. Best practices\n4. Common pitfalls to avoid\n\nFormat your response for maximum clarity and usefulness.`,
                    concise: `Please provide a concise and direct response to the following task:\n\n{input}\n\nFocus on the most essential information only.`,
                    creative: `You are a creative expert. Please approach this task with imagination and flair:\n\n{input}\n\nFocus on:\n‚Ä¢ Original ideas\n‚Ä¢ Engaging storytelling\n‚Ä¢ Emotional resonance\n‚Ä¢ Unique perspectives`,
                    analytical: `As an analytical expert, please provide a data-driven response to:\n\n{input}\n\nInclude:\n1. Logical framework\n2. Evidence-based reasoning\n3. Statistical insights\n4. Risk assessment\n5. Optimization suggestions`
                }
            };

            // Default Settings
            const DEFAULT_SETTINGS = {
                aiModel: 'gemini',
                promptStyle: 'detailed',
                autoConvert: true,
                voiceInput: false
            };

            // State Management
            let state = {
                settings: {...DEFAULT_SETTINGS},
                showAdvanced: false,
                showOtherTools: false,
                currentBestModel: 'gemini',
                autoConvertTimer: null,
                lastInput: ''
            };

            // DOM Elements Cache
            let elements = {};

            // Initialize DOM elements
            const initElements = () => {
                const elementIds = [
                    'userInput', 'outputCard', 'aiCard', 'outputArea', 'charCountValue',
                    'otherTools', 'otherToolsToggle', 'toolsIcon', 'bestAIButton', 'aiExplanation',
                    'copyBtn', 'useInAI', 'prepareBtn', 'btnText', 'btnLoading',
                    'progressLine', 'step1Card',
                    // Settings elements
                    'settingsModal', 'settingsToggle', 'closeSettings',
                    'aiModel', 'promptStyle', 'autoConvertToggle', 'voiceInputToggle',
                    'resetSettings', 'saveSettings'
                ];
                
                elementIds.forEach(id => {
                    elements[id] = document.getElementById(id);
                });
            };

            // Initialize Application
            const init = () => {
                initElements();
                loadSettings();
                setupEventListeners();
                updateProgress(1);
                
                // Load example on first visit
                setTimeout(() => {
                    if (!elements.userInput.value.trim() && !localStorage.getItem(CONFIG.STORAGE_KEYS.VISITED)) {
                        insertExample('email');
                        localStorage.setItem(CONFIG.STORAGE_KEYS.VISITED, 'true');
                    }
                }, 100);
            };

            // Load settings from localStorage
            const loadSettings = () => {
                try {
                    const saved = localStorage.getItem(CONFIG.STORAGE_KEYS.SETTINGS);
                    if (saved) {
                        state.settings = {...DEFAULT_SETTINGS, ...JSON.parse(saved)};
                    }
                    
                    // Update UI with loaded settings
                    updateSettingsUI();
                    
                    // Load saved input
                    const savedInput = localStorage.getItem(CONFIG.STORAGE_KEYS.INPUT);
                    if (savedInput) {
                        elements.userInput.value = savedInput;
                        elements.charCountValue.textContent = savedInput.length;
                    }
                } catch (error) {
                    console.error('Failed to load settings:', error);
                    state.settings = {...DEFAULT_SETTINGS};
                }
            };

            // Update settings UI elements
            const updateSettingsUI = () => {
                if (!elements.aiModel) return;
                
                // Update form fields
                elements.aiModel.value = state.settings.aiModel;
                elements.promptStyle.value = state.settings.promptStyle;
                
                // Update toggle switches
                elements.autoConvertToggle.classList.toggle('active', state.settings.autoConvert);
                elements.voiceInputToggle.classList.toggle('active', state.settings.voiceInput);
            };

            // Save settings to localStorage
            const saveSettings = () => {
                try {
                    localStorage.setItem(CONFIG.STORAGE_KEYS.SETTINGS, JSON.stringify(state.settings));
                    showNotification('Settings saved successfully!');
                } catch (error) {
                    console.error('Failed to save settings:', error);
                    showNotification('Failed to save settings', true);
                }
            };

            // Setup event listeners
            const setupEventListeners = () => {
                // Input handling
                elements.userInput.addEventListener('input', handleInput);
                
                // Event delegation for chips and buttons
                document.addEventListener('click', (e) => {
                    // Example chips
                    if (e.target.matches('.chip[data-type]')) {
                        handleExampleChipClick(e.target.dataset.type);
                    }
                    
                    // AI tool buttons
                    if (e.target.matches('.ai-tool-btn')) {
                        handleAIToolClick(e.target.dataset.model);
                    }
                });
                
                // Main action buttons
                elements.prepareBtn.addEventListener('click', preparePrompt);
                elements.copyBtn.addEventListener('click', copyPrompt);
                elements.useInAI.addEventListener('click', () => elements.bestAIButton.click());
                elements.bestAIButton.addEventListener('click', handleBestAIClick);
                elements.otherToolsToggle.addEventListener('click', toggleOtherTools);
                
                // Settings modal
                elements.settingsToggle.addEventListener('click', openSettings);
                elements.closeSettings.addEventListener('click', closeSettings);
                elements.resetSettings.addEventListener('click', resetSettings);
                elements.saveSettings.addEventListener('click', saveSettingsFromUI);
                
                // Toggle switches
                elements.autoConvertToggle.addEventListener('click', () => toggleSetting('autoConvert'));
                elements.voiceInputToggle.addEventListener('click', () => toggleSetting('voiceInput'));
                
                // Close modal on backdrop click
                elements.settingsModal.addEventListener('click', (e) => {
                    if (e.target === elements.settingsModal) {
                        closeSettings();
                    }
                });
                
                // Escape key to close settings
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && elements.settingsModal.classList.contains('active')) {
                        closeSettings();
                    }
                });
            };

            // Handle input changes
            const handleInput = () => {
                const count = elements.userInput.value.length;
                elements.charCountValue.textContent = count;
                
                try {
                    localStorage.setItem(CONFIG.STORAGE_KEYS.INPUT, elements.userInput.value);
                } catch (error) {
                    console.error('Failed to save input:', error);
                }
                
                // Auto-convert logic if enabled
                if (state.settings.autoConvert && elements.userInput.value.length > 10) {
                    if (state.autoConvertTimer) clearTimeout(state.autoConvertTimer);
                    state.autoConvertTimer = setTimeout(() => {
                        if (elements.userInput.value === state.lastInput) {
                            preparePrompt();
                        }
                    }, CONFIG.AUTO_CONVERT_DELAY);
                    state.lastInput = elements.userInput.value;
                }
            };

            // Toggle settings
            const toggleSetting = (settingName) => {
                state.settings[settingName] = !state.settings[settingName];
                updateSettingsUI();
            };

            // Open settings modal
            const openSettings = () => {
                elements.settingsModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            };

            // Close settings modal
            const closeSettings = () => {
                elements.settingsModal.classList.remove('active');
                document.body.style.overflow = '';
            };

            // Reset settings to defaults
            const resetSettings = () => {
                if (confirm('Reset all settings to defaults?')) {
                    state.settings = {...DEFAULT_SETTINGS};
                    updateSettingsUI();
                    showNotification('Settings reset to defaults');
                }
            };

            // Save settings from UI
            const saveSettingsFromUI = () => {
                // Get values from form
                state.settings.aiModel = elements.aiModel.value;
                state.settings.promptStyle = elements.promptStyle.value;
                
                // Save to localStorage
                saveSettings();
                closeSettings();
            };

            // Handle example chip clicks
            const handleExampleChipClick = (type) => {
                insertExample(type);
            };

            // Handle AI tool clicks
            const handleAIToolClick = (modelKey) => {
                const model = CONFIG.MODEL_CONFIG[modelKey];
                if (model) {
                    window.open(model.url, '_blank');
                    showNotification(`Opening ${model.name}...`);
                }
            };

            // Handle best AI click
            const handleBestAIClick = () => {
                const model = CONFIG.MODEL_CONFIG[state.currentBestModel];
                if (model) {
                    window.open(model.url, '_blank');
                    showNotification(`Opening ${model.name}...`);
                }
            };

            // Insert example
            const insertExample = (type) => {
                const examples = {
                    email: "Write a professional email to decline a meeting invitation while maintaining good relationships. The tone should be polite but firm.",
                    code: "Create a Python function to calculate Fibonacci sequence with memoization and proper error handling.",
                    analysis: "Analyze quarterly sales data and identify top performing products and regions with recommendations.",
                    creative: "Write a short story about a robot discovering human emotions for the first time."
                };
                
                elements.userInput.value = examples[type] || examples.email;
                elements.charCountValue.textContent = elements.userInput.value.length;
                
                try {
                    localStorage.setItem(CONFIG.STORAGE_KEYS.INPUT, elements.userInput.value);
                } catch (error) {
                    console.error('Failed to save example:', error);
                }
            };

            // Toggle other tools
            const toggleOtherTools = () => {
                state.showOtherTools = !state.showOtherTools;
                elements.toolsIcon.textContent = state.showOtherTools ? '‚ñ≤' : '‚ñº';
                
                if (state.showOtherTools) {
                    elements.otherTools.classList.add('expanded');
                } else {
                    elements.otherTools.classList.remove('expanded');
                }
            };

            // Determine best AI model based on input
            const determineBestModel = (input) => {
                const lower = input.toLowerCase();
                
                // Check if user has a preferred model in settings
                if (state.settings.aiModel && CONFIG.MODEL_CONFIG[state.settings.aiModel]) {
                    return state.settings.aiModel;
                }
                
                // Otherwise, determine based on content
                if (lower.includes('code') || lower.includes('python') || lower.includes('function')) {
                    return 'claude';
                } else if (lower.includes('analyze') || lower.includes('data') || lower.includes('research')) {
                    return 'gemini';
                } else if (lower.includes('creative') || lower.includes('story') || lower.includes('email')) {
                    return 'chatgpt';
                } else if (lower.includes('humor') || lower.includes('funny')) {
                    return 'grok';
                }
                
                return 'gemini'; // Default
            };

            // Get routing explanation
            const getRoutingExplanation = (input, modelKey) => {
                const model = CONFIG.MODEL_CONFIG[modelKey];
                const lower = input.toLowerCase();
                
                if (modelKey === 'claude' && lower.includes('code')) {
                    return 'Best for coding and technical tasks';
                } else if (modelKey === 'gemini' && lower.includes('analyze')) {
                    return 'Best for analysis and data-driven tasks';
                } else if (modelKey === 'chatgpt' && lower.includes('creative')) {
                    return 'Best for creative writing and communication';
                } else if (modelKey === 'grok' && lower.includes('humor')) {
                    return 'Best for humor and real-time information';
                }
                
                return model?.explanation || 'Chosen based on task type';
            };

            // Prepare prompt
            const preparePrompt = () => {
                const input = elements.userInput.value.trim();
                
                if (state.autoConvertTimer) {
                    clearTimeout(state.autoConvertTimer);
                    state.autoConvertTimer = null;
                }
                
                if (!input) {
                    showNotification('Please describe your task to continue', true);
                    elements.userInput.focus();
                    return;
                }

                state.currentBestModel = determineBestModel(input);
                const bestModel = CONFIG.MODEL_CONFIG[state.currentBestModel];
                const explanation = getRoutingExplanation(input, state.currentBestModel);

                setLoadingState(true);

                setTimeout(() => {
                    try {
                        // Use selected prompt style from settings
                        const promptStyle = state.settings.promptStyle || 'detailed';
                        const prompt = CONFIG.INTENT_TEMPLATES[promptStyle].replace('{input}', input);
                        elements.outputArea.textContent = prompt;
                        
                        // Update AI button with model info
                        const freeTag = bestModel.isFree ? '<span class="model-tag free">Free</span>' : '<span class="model-tag paid">Pro</span>';
                        elements.bestAIButton.innerHTML = `üöÄ Open in ${bestModel.name} ${freeTag}`;
                        elements.aiExplanation.textContent = explanation;
                        
                        showResultCards();
                        
                        setTimeout(() => {
                            scrollToCard(elements.outputCard);
                            updateProgress(2);
                        }, 100);
                        
                        setTimeout(() => {
                            updateProgress(3);
                        }, 500);
                        
                    } catch (error) {
                        showNotification('Failed to generate prompt. Please try again.', true);
                        console.error('Prompt generation error:', error);
                    } finally {
                        setLoadingState(false);
                    }
                }, CONFIG.PROMPT_GENERATION_DELAY);
            };

            // Show notification
            const showNotification = (message, isError = false) => {
                // Simple alert for now - can be enhanced with toast notifications
                if (isError) {
                    alert(`‚ö†Ô∏è ${message}`);
                } else {
                    console.log(`‚úÖ ${message}`);
                }
            };

            // Set loading state
            const setLoadingState = (isLoading) => {
                elements.prepareBtn.disabled = isLoading;
                elements.btnText.textContent = isLoading ? 'Preparing...' : 'Prepare Prompt';
                elements.btnLoading.classList.toggle('hidden', !isLoading);
            };

            // Show result cards
            const showResultCards = () => {
                elements.outputCard.classList.remove('hidden');
                elements.outputCard.classList.add('animate-slideUp');
                
                setTimeout(() => {
                    elements.aiCard.classList.remove('hidden');
                    elements.aiCard.classList.add('animate-slideUp');
                }, 300);
            };

            // Copy prompt to clipboard
            const copyPrompt = async () => {
                const text = elements.outputArea.textContent;
                if (!text || text.includes('Your optimized prompt will appear here')) {
                    showNotification('No prompt to copy', true);
                    return;
                }
                
                try {
                    await navigator.clipboard.writeText(text);
                    showNotification('Prompt copied to clipboard!');
                    
                    // Visual feedback
                    const originalText = elements.copyBtn.textContent;
                    elements.copyBtn.textContent = '‚úì Copied!';
                    elements.copyBtn.classList.add('bg-green-50', 'text-green-700', 'border-green-200');
                    
                    setTimeout(() => {
                        elements.copyBtn.textContent = originalText;
                        elements.copyBtn.classList.remove('bg-green-50', 'text-green-700', 'border-green-200');
                    }, 2000);
                } catch (error) {
                    console.error('Failed to copy text:', error);
                    showNotification('Failed to copy. Please select and copy manually.', true);
                }
            };

            // Scroll to and highlight a card
            const scrollToCard = (cardElement) => {
                if (!cardElement) return;
                
                const headerHeight = 80;
                const cardRect = cardElement.getBoundingClientRect();
                const absoluteCardTop = window.pageYOffset + cardRect.top;
                const scrollPosition = absoluteCardTop - (window.innerHeight / 2) + (cardRect.height / 2) + headerHeight;
                
                window.scrollTo({
                    top: scrollPosition,
                    behavior: 'smooth'
                });
                
                cardElement.classList.add('highlight', 'animate-highlight');
                
                setTimeout(() => {
                    cardElement.classList.remove('animate-highlight');
                }, 1500);
            };

            // Update progress indicator
            const updateProgress = (step) => {
                const progressWidth = {
                    1: '0%',
                    2: '33%',
                    3: '66%',
                    4: '100%'
                }[step] || '0%';
                
                if (elements.progressLine) {
                    elements.progressLine.style.width = progressWidth;
                }
            };

            // Public API
            return {
                init,
                preparePrompt,
                copyPrompt,
                openSettings,
                closeSettings
            };
        })();

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            PromptCraft.init();
        });
    </script>
</body>
</html>
